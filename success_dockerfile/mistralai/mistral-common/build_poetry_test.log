#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 1.09kB done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/library/python:3.10
#2 DONE 0.0s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [1/5] FROM docker.io/library/python:3.10
#4 DONE 0.0s

#5 [2/5] RUN mkdir -p ~/.pip && touch ~/.pip/pip.conf &&     echo "[global]" >> ~/.pip/pip.conf && echo "index-url=http://simple/" >> ~/.pip/pip.conf && echo "[install]" >> ~/.pip/pip.conf && echo "trusted-host=pypi..org" >> ~/.pip/pip.conf &&     apt-get update && apt-get install -y curl &&     curl -sSL https://install.python-poetry.org | python -
#5 CACHED

#6 [3/5] RUN pip install pytest pytest-xdist &&     pip install pipdeptree &&     git clone https://github.com/mistralai/mistral-common.git &&     mkdir /repo &&     git config --global --add safe.directory /repo &&     cp -r /mistral-common/. /repo && rm -rf /mistral-common/ &&     rm -rf /mistral-common &&     cd /repo && git checkout 5cac5e1c05d9e6782bec49310e43f294649bc1e2 &&     cd /repo && poetry install
#6 CACHED

#7 [4/5] RUN cd /repo && poetry run pytest --collect-only -q
#7 15.96 tests/test_fim_tokenizer.py::test_encode_fim
#7 15.96 tests/test_integration_samples.py::test_samples[v1-get_weather_full]
#7 15.96 tests/test_integration_samples.py::test_samples[v1-get_weather_no_history]
#7 15.96 tests/test_integration_samples.py::test_samples[v1-several_calls]
#7 15.96 tests/test_integration_samples.py::test_samples[v1-no_tools]
#7 15.96 tests/test_integration_samples.py::test_samples[v1-get_weather_no_system_prompt]
#7 15.96 tests/test_integration_samples.py::test_samples[v1-parallel_calls]
#7 15.96 tests/test_integration_samples.py::test_samples[v2-get_weather_full]
#7 15.96 tests/test_integration_samples.py::test_samples[v2-get_weather_no_history]
#7 15.96 tests/test_integration_samples.py::test_samples[v2-several_calls]
#7 15.96 tests/test_integration_samples.py::test_samples[v2-no_tools]
#7 15.96 tests/test_integration_samples.py::test_samples[v2-get_weather_no_system_prompt]
#7 15.96 tests/test_integration_samples.py::test_samples[v2-parallel_calls]
#7 15.96 tests/test_integration_samples.py::test_samples[v3-get_weather_full]
#7 15.96 tests/test_integration_samples.py::test_samples[v3-get_weather_no_history]
#7 15.96 tests/test_integration_samples.py::test_samples[v3-several_calls]
#7 15.96 tests/test_integration_samples.py::test_samples[v3-no_tools]
#7 15.96 tests/test_integration_samples.py::test_samples[v3-get_weather_no_system_prompt]
#7 15.96 tests/test_integration_samples.py::test_samples[v3-parallel_calls]
#7 15.96 tests/test_mistral_tokenizer.py::TestMistralToknizer::test_from_model
#7 15.96 tests/test_mistral_tokenizer.py::TestMistralToknizer::test_decode
#7 15.96 tests/test_multimodal.py::test_image_to_num_tokens
#7 15.96 tests/test_multimodal.py::test_download_gated_image
#7 15.96 tests/test_multimodal.py::test_image_encoder
#7 15.96 tests/test_multimodal.py::test_image_processing[size0]
#7 15.96 tests/test_multimodal.py::test_image_processing[size1]
#7 15.96 tests/test_multimodal.py::test_image_processing[size2]
#7 15.96 tests/test_multimodal.py::test_image_processing[size3]
#7 15.96 tests/test_multimodal.py::test_image_processing[size4]
#7 15.96 tests/test_multimodal.py::test_image_processing[size5]
#7 15.96 tests/test_multimodal.py::test_image_encoder_formats
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_user_system_user
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_multiple_system
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_single_system
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_system_assistant_user
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_system_assistant_user_v7
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_assistant_system_user_adds_user
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_assistant_assistant_system_v7
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_message_aggregation
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_normalize_chunks
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_many_chunks_in_user_message
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_safety_prompt_aggregated
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_system_prompt_chunks_aggregated
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_normalize_tools
#7 15.96 tests/test_normalization.py::TestChatCompletionRequestNormalization::test_normalize_funcalls
#7 15.96 tests/test_normalization.py::TestFineTuningNormalizer::test_normalize_weighted_assistant
#7 15.96 tests/test_normalization.py::TestFineTuningNormalizer::test_should_not_aggregate_if_weight_is_different
#7 15.96 tests/test_tekken.py::test_roundtrip
#7 15.96 tests/test_tekken.py::test_version
#7 15.96 tests/test_tekken.py::test_read_from_file
#7 15.96 tests/test_tekken.py::test_istekken
#7 15.96 tests/test_tekken.py::test_isbyte
#7 15.96 tests/test_tokenize_v1.py::test_normal
#7 15.96 tests/test_tokenize_v1.py::test_system_singleturn
#7 15.96 tests/test_tokenize_v1.py::test_system_multiturn
#7 15.96 tests/test_tokenize_v2.py::test_normal
#7 15.96 tests/test_tokenize_v2.py::test_tools_singleturn
#7 15.96 tests/test_tokenize_v2.py::test_tools_multiturn
#7 15.96 tests/test_tokenize_v2.py::test_system_singleturn
#7 15.96 tests/test_tokenize_v2.py::test_system_multiturn
#7 15.96 tests/test_tokenize_v2.py::test_system_tools_multiturn
#7 15.96 tests/test_tokenize_v2.py::test_tool_response
#7 15.96 tests/test_tokenize_v2.py::test_tool_message_multiple_shots_without_history
#7 15.96 tests/test_tokenize_v3.py::test_is_spm
#7 15.96 tests/test_tokenize_v3.py::test_spm_version
#7 15.96 tests/test_tokenize_v3.py::test_tools_singleturn[tokenizer0-\u2581-\u2581-6-7-expected_tokens_before_tool0]
#7 15.96 tests/test_tokenize_v3.py::test_tools_singleturn[tokenizer1-- -5-6-expected_tokens_before_tool1]
#7 15.96 tests/test_tokenize_v3.py::test_tools_multiturn[tokenizer0-\u2581-\u2581-6-7-expected_tokens_before_tool0-expected_tokens_after_tool0]
#7 15.96 tests/test_tokenize_v3.py::test_tools_multiturn[tokenizer1-- -5-6-expected_tokens_before_tool1-expected_tokens_after_tool1]
#7 15.96 tests/test_tokenize_v3.py::test_system_tools_multiturn[tokenizer0-\u2581-\u2581-6-7-<0x0A><0x0A>-a b-SYSTEM\n\nc d]
#7 15.96 tests/test_tokenize_v3.py::test_system_tools_multiturn[tokenizer1-- -5-6-\n\n-ab-SYSTEM\n\ncd]
#7 15.96 tests/test_tokenize_v3.py::test_tool_message[tokenizer0-\u2581-\u2581]
#7 15.96 tests/test_tokenize_v3.py::test_tool_message[tokenizer1-- ]
#7 15.96 tests/test_tokenize_v3.py::test_tool_message_no_id_fine_tuning_ok[tokenizer0-\u2581-\u2581]
#7 15.96 tests/test_tokenize_v3.py::test_tool_message_no_id_fine_tuning_ok[tokenizer1-- ]
#7 15.96 tests/test_tokenize_v3.py::test_tool_message_multiple_shots_with_history[tokenizer0-\u2581-\u2581]
#7 15.96 tests/test_tokenize_v3.py::test_tool_message_multiple_shots_with_history[tokenizer1-- ]
#7 15.96 tests/test_tokenize_v3.py::test_tool_message_multiple_calls[tokenizer0-\u2581-\u2581]
#7 15.96 tests/test_tokenize_v3.py::test_tool_message_multiple_calls[tokenizer1-- ]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_agreement_with_text_only[r0]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_agreement_with_text_only[r1]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_agreement_with_text_only[r2]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_agreement_with_text_only[r3]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_swap_text_image_special_case
#7 15.96 tests/test_tokenizer_v3_mm.py::test_mm_normalizer[r0]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_mm_normalizer[r1]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_mm_normalizer[r2]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_mm_normalizer[r3]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_mm_normalizer[r4]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_mm_normalizer[r5]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_mm_normalizer[r6]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_mm_normalizer[r7]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_mm_normalizer[r8]
#7 15.96 tests/test_tokenizer_v3_mm.py::test_image_tokenization_integration
#7 15.96 tests/test_tokenizer_v7.py::test_tokenize_assistant_message
#7 15.96 tests/test_tokenizer_v7.py::test_encode_spm[messages0-<s>[SYSTEM_PROMPT]\u2581a[/SYSTEM_PROMPT][AVAILABLE_TOOLS]\u2581[{"type":\u2581"function",\u2581"function":\u2581{"name":\u2581"t",\u2581"description":\u2581"",\u2581"parameters":\u2581{"type":\u2581"object",\u2581"properties":\u2581{"g":\u2581{"type":\u2581"string"},\u2581"h":\u2581{"type":\u2581"string"}}}}}][/AVAILABLE_TOOLS][INST]\u2581a[/INST]\u2581b[TOOL_CALLS]\u2581[{"name":\u2581"t",\u2581"arguments":\u2581{"g":\u2581"h"}}]</s>]
#7 15.96 tests/test_tokenizer_v7.py::test_encode_spm[messages1-<s>[SYSTEM_PROMPT]\u2581a[/SYSTEM_PROMPT][INST]\u2581a[/INST][AVAILABLE_TOOLS]\u2581[{"type":\u2581"function",\u2581"function":\u2581{"name":\u2581"t",\u2581"description":\u2581"",\u2581"parameters":\u2581{"type":\u2581"object",\u2581"properties":\u2581{"g":\u2581{"type":\u2581"string"},\u2581"h":\u2581{"type":\u2581"string"}}}}}][/AVAILABLE_TOOLS][INST]\u2581c[/INST]\u2581b[TOOL_CALLS]\u2581[{"name":\u2581"t",\u2581"arguments":\u2581{"g":\u2581"h"}}]</s>[TOOL_RESULTS]\u25811234[TOOL_CONTENT]\u2581b[/TOOL_RESULTS]]
#7 15.96 tests/test_tokenizer_v7.py::test_encode_chat_completion
#7 15.96 tests/test_tokenizer_v7.py::test_truncation[keep_sys_and_last_message]
#7 15.96 tests/test_tokenizer_v7.py::test_truncation[messages1-<s>[INST]b[/INST][INST]a[/INST][INST]aaaaaaa[/INST]]
#7 15.96 tests/test_tokenizer_v7.py::test_truncation[messages2-<s>b</s>[INST]a[/INST][INST]aaaaaaa[/INST]]
#7 15.96 tests/test_tokenizer_v7.py::test_truncation[drop_by_chunk_1]
#7 15.96 tests/test_tokenizer_v7.py::test_truncation[drop_by_chunk_2]
#7 15.96 tests/test_tokenizer_v7.py::test_truncation[full_convo]
#7 15.96 tests/test_tokenizer_v7.py::test_truncation_failed[messages0]
#7 15.96 tests/test_tokenizer_v7.py::test_truncation_failed[messages1]
#7 15.96 tests/test_tokenizer_v7.py::test_from_model
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_multiple_system_messages_OK[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_multiple_system_messages_OK[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_system_user_messages_OK[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_system_user_messages_OK[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_user_system_messages_OK[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_user_system_messages_OK[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_user_user_messages_OK[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_user_user_messages_OK[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_empty_messages[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_empty_messages[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_starts_with_system_or_user[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_starts_with_system_or_user[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_ends_with_assistant[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_ends_with_assistant[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_assistant_prefix[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_assistant_prefix[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_user_tool_user[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_user_tool_user[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_model_none_serving_mode
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_model_none_test_mode
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_tool_calls_OK[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_tool_calls_OK[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_not_enough_tool_messages[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_not_enough_tool_messages[validator1]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_too_many_tool_messages[validator0]
#7 15.96 tests/validation/test_chat_validation.py::TestChatValidation::test_too_many_tool_messages[validator1]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_ends_with_assistant[validator0]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_ends_with_assistant[validator1]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_has_weight_in_message_assistant[validator0]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_has_weight_in_message_assistant[validator1]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_has_invalid_weight_in_message_assistant[validator0]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_has_invalid_weight_in_message_assistant[validator1]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_should_allow_multiple_weights[validator0]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_should_allow_multiple_weights[validator1]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_ends_with_tool_call_null[validator0]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_ends_with_tool_call_null[validator1]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_ends_with_no_tool_call[validator0]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_ends_with_no_tool_call[validator1]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_middle_with_tool_call_null_raises[validator0]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_middle_with_tool_call_null_raises[validator1]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_one_message_with_user_is_not_valid[validator0]
#7 15.96 tests/validation/test_finetuning_validation.py::TestFineTuningValidation::test_one_message_with_user_is_not_valid[validator1]
#7 15.96 tests/validation/test_request.py::TestValidateRequest::test_request_random_seed_negative
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_content_and_tool_calls[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_content_and_tool_calls[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_no_tool_calls[validator0--None]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_no_tool_calls[validator0-None-None]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_no_tool_calls[validator0--tool_calls2]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_no_tool_calls[validator0-None-tool_calls3]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_no_tool_calls[validator1--None]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_no_tool_calls[validator1-None-None]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_no_tool_calls[validator1--tool_calls2]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_no_tool_calls[validator1-None-tool_calls3]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_tool_calls[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_no_content_and_tool_calls[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_content_and_no_tool_calls[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_content_and_no_tool_calls[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_bad_function_name[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_bad_function_name[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_invalid_function_json[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_invalid_function_json[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_tool_id_defined[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_tool_id_defined[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_tool_calls_bad_id[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateAssistantMessage::test_tool_calls_bad_id[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateUserMessage::test_user_message_blank_content_OK[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateUserMessage::test_user_message_blank_content_OK[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateToolMessage::test_tool_message_bad_name[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateToolMessage::test_tool_message_bad_name[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateToolMessage::test_tool_message_invalid_json[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateToolMessage::test_tool_message_invalid_json[validator1]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateToolMessage::test_tool_message_bad_id[validator0]
#7 15.96 tests/validation/test_serving_validation.py::TestValidateToolMessage::test_tool_message_bad_id[validator1]
#7 15.96 tests/validation/test_validation.py::TestValidateTools::test_tool_function_bad_name
#7 15.96 tests/validation/test_validation.py::TestValidateTools::test_tool_function_invalid_schema
#7 15.96 
#7 15.96 182 tests collected in 13.74s
#7 DONE 17.2s

#8 exporting to image
#8 exporting layers
#8 exporting layers 2.6s done
#8 writing image sha256:f321d08896c3b14de5d373d1fac93ea609e791916b7bc7b507b95f9ee1dfc1c8 done
#8 naming to docker.io/library/tmp:tmp done
#8 DONE 2.6s
